<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" 
  xmlns:h="http://java.sun.com/jsf/html" 
  xmlns:f="http://java.sun.com/jsf/core" 
  xmlns:p="http://primefaces.org/ui" 
  xmlns:composite="http://java.sun.com/jsf/composite">

<composite:interface>
  <composite:attribute name="popupId" default="SearchPopup"/>
  <composite:attribute name="title" default="#{bundle['searchPopup.client-title']}"/>
  <composite:attribute name="widgetVar" default="SearchPopup"/>
  <composite:attribute name="callbackListener" type="com.aviva.bean.component.ActionCallbackListener"/>
  <composite:attribute name="callbackBean" required="true" type="com.aviva.clms.ejb.bean.Client"/>
  <composite:attribute name="addNewButtonLabel" default="#{bundle['searchPopup.label.client-add-button']}"/>
  <composite:attribute name="searchLabel" default="#{bundle['searchPopup.label.client-search-box']}"/>
</composite:interface>

<composite:implementation>
  <p:dialog id="#{cc.attrs.popupId}" header="#{cc.attrs.title}" widgetVar="#{cc.attrs.widgetVar}" modal="true" style="position: fixed;">
    <h:form>
      <div>
        <div>
          <div align="right">
            <div style="margin-bottom: 5px;">
              <p:inputText id="searchText" value="#{clientSearch.searchText}"/>
              <p:commandButton styleClass="button" value="#{cc.attrs.searchLabel}" actionListener="#{clientSearch.searchAction}" update="@widgetVar(dataTable)"/>
            </div>

            <p:dataTable id="dataTable" var="row" value="#{clientSearch.data}" widgetVar="dataTable" paginator="true" rows="10" lazy="true" selection="#{clientSearch.selectedClient}" selectionMode="single" emptyMessage="#{bundle['global.msg.data-table-empty']}">
              <p:ajax event="rowSelect" listener="#{clientSearch.onRowSelect(cc.attrs.callbackBean, cc.attrs.callbackListener)}" oncomplete="PF('#{cc.attrs.widgetVar}').hide();"/>
              
              <p:column headerText="#{bundle['client.label.full-name']}">
                <h:outputText value="#{row.data.name}" />
              </p:column>
              
              <p:column headerText="#{bundle['client.label.pid']}">
                <h:outputText value="#{row.data.pid}" />
              </p:column>
              
              <p:column headerText="#{bundle['corporation.label.CIF-code-in-core-bank']}">
                <h:outputText value="#{row.data.cifCode}" />
              </p:column>
              
              <p:column headerText="#{bundle['client.label.gender']}">
                <h:outputText value="#{row.data.gender == 'M' ? bundle['client.label.male'] : bundle['client.label.female']}" />
              </p:column>
              
              <p:column headerText="#{bundle['client.label.dob']}">
                <h:outputText value="#{row.data.dob}">
                  <f:convertDateTime pattern="dd/MM/yyyy" />
                </h:outputText>
              </p:column>
            </p:dataTable>
          </div>
          <table width="100%">
            <tbody>
              <tr>
                <td align="right"><p:commandButton action="#{clientSearch.addNewAction}" value="#{cc.attrs.addNewButtonLabel}"/></td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
    </h:form>
  </p:dialog>
</composite:implementation>
</html>